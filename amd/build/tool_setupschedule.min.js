define ("block_maj_submissions/tool_setupschedule",["jquery","jqueryui","core/str","block_maj_submissions/html","block_maj_submissions/unicode"],function($,JUI,STR,HTML,UNICODE){var TOOL={APPLY_NONE:0,APPLY_CURRENT:1,APPLY_THISDAY:2,APPLY_ALLDAYS:3,sourcesession:null,sessiontypes:"case|event|featured|keynote|lightning|paper|poster|presentation|showcase|virtual|workshop",sessiontimeroom:".time, .room",sessioncontent:".title, .authors, .categorytypetopic, .summary, .scheduleinfo",details:{roomname:null,roomseats:null,roomtopic:null},dialogid:"dialog",str:{}};TOOL.init=function(opts){if(opts){for(var i in opts){TOOL[i]=opts[i]}}TOOL.wwwroot=location.href.replace(/^(.*?)\/blocks.*$/,"$1");TOOL.blockroot=location.href.replace(/^(.*?)\/tools.*$/,"$1");TOOL.toolroot=location.href.replace(/^(.*?)\/tool.php.*$/,"$1");TOOL.pageid=location.href.replace(/^.*?\bid=([0-9]+)\b.*$/,"$1");if(0==$("img.iconhelp").length){TOOL.iconroot=TOOL.wwwroot+"/pix";TOOL.iconedit=TOOL.iconroot+"/i/edit.svg";TOOL.iconremove=TOOL.iconroot+"/i/delete.svg"}else{TOOL.iconroot=$("img.iconhelp").prop("src").replace(/\/[^/]+$/,"");TOOL.iconedit=TOOL.iconroot+"/i/edit";TOOL.iconremove=TOOL.iconroot+"/i/delete"}$("#id_sessioninfo").css("display","none");$("<link/>",{rel:"stylesheet",type:"text/css",href:TOOL.toolroot+"/styles.css"}).appendTo("head");$("<link/>",{rel:"stylesheet",type:"text/css",href:TOOL.blockroot+"/templates/template.css"}).appendTo("head");$.getScript(TOOL.blockroot+"/templates/template.js");var loadstrings=$.Deferred();$.ajax({url:TOOL.toolroot+"/action.php",data:{id:TOOL.pageid,action:"loadstrings"},dataType:"text",method:"GET",success:function success(txt){var regexp=/MAJ/g;eval(txt.replace(regexp,"TOOL"));loadstrings.resolve()}});var tools=$("<div></div>",{id:"tools"}).insertAfter("#id_sessioninfo"),p={id:TOOL.pageid,action:"loadtools"};tools.load(TOOL.toolroot+"/action.php",p,function(e,t,s){if("success"==t){$(this).html(e);TOOL.setup_tools(this)}else if("error"==t){$(this).html(TOOL.format_ajax_error(p.action,e,s))}});var schedule=$("<div></div>",{id:"schedule"}).insertAfter("#tools"),p={id:TOOL.pageid,action:"loadschedule"};schedule.load(TOOL.toolroot+"/action.php",p,function(e,t,s){if("success"==t){$(this).html(e);TOOL.setup_schedule(this,loadstrings)}else if("error"==t){$(this).html(TOOL.format_ajax_error(p.action,e,s))}});var items=$("<div></div>",{id:"items",class:"schedule"}).insertAfter("#schedule"),p={id:TOOL.pageid,action:"loaditems"};items.load(TOOL.toolroot+"/action.php",p,function(e,t,s){if("success"==t){$(this).html(e);TOOL.setup_items(this,loadstrings)}else if("error"==t){$(this).html(TOOL.format_ajax_error(p.action,e,s))}});$("form.mform").submit(function(){TOOL.set_schedule_html();TOOL.set_schedule_unassigned()})};TOOL.setup_tools=function(e){$(e).find(".command").each(function(){var e=!0;$(this).find(".subcommand").each(function(){$(this).click(function(e){var t=$(this).prop("id"),o=t.indexOf("-"),n=t.substring(0,o),r=t.substring(o+1),s=n+"_"+r;if(TOOL[s]){TOOL[s](e)}else if(TOOL[n]){TOOL[n](e,r)}});e=!1});if(e){$(this).click(function(e){var t=$(this).prop("id");TOOL[t](e)})}})};TOOL.setup_schedule=function(e,t){TOOL.clean_emptysessions(e);TOOL.setup_table_rooms(e);TOOL.fix_times_and_rooms(e);TOOL.fix_multislot_times(e);TOOL.hide_multilang_spans(e);TOOL.make_sessions_droppable(e);TOOL.make_sessions_draggable(e);TOOL.make_sessions_selectable(e);$.when(t).done(function(){var e=document.querySelector("table.schedule");TOOL.make_sessions_editable(e);TOOL.make_rooms_editable(e);TOOL.make_slots_editable(e);TOOL.make_days_editable(e)})};TOOL.setup_items=function(e,t){TOOL.make_sessions_draggable(e);$.when(t).done(function(){var e=document.getElementById("items");TOOL.make_sessions_selectable(e);TOOL.make_sessions_editable(e)})};TOOL.format_ajax_error=function(e,t,s){var o=!1,a=t.indexOf("<footer id=\"page-footer\"");if(0<=a){t=t.substr(0,a);o=!0}var a=t.indexOf("<div id=\"page-content\"");if(0<=a){t=t.substr(a);o=!0}if(o){t=t.replace(/<form[^>]*>.*?<\/form>/g,"");t=t.replace(/<p class="errorcode">.*?<\/p>/,"");t=t.replace(/<div class="continuebutton">.*?<\/div>/,"");return t}return"Error ("+e+") "+s.status+": "+s.statusText};TOOL.clean_emptysessions=function(e){$(e).find(".emptysession").each(function(){$(this).removeClass(TOOL.get_non_jquery_classes(this)).addClass("session emptysession")})};TOOL.setup_table_rooms=function(e){var t=0;$(e).find("tbody").each(function(){TOOL.setup_tbody_rooms(this);t=Math.max(t,$(this).data("roomcount"))});$(e).data("roomcount",t)};TOOL.setup_tbody_rooms=function(e){var t=[],s=0;$(e).find("tr").each(function(){$(this).find("th.roomheading").each(function(e){$(this).prop("class",$(this).prop("class").replace(/\broom\d+\b/g,""));$(this).addClass("room"+(e+1))});var e=0;$(this).find("th, td").each(function(){while(t[e]){t[e]--;e++}$(this).data("room",e);s=Math.max(s,e);var o=$(this).prop("rowspan")||1,a=$(this).prop("colspan")||1;while(0<a){t[e]=o-1+(t[e]||0);e++;a--}if($(this).is(":last-child")){while(e<t.length){if(t[e]){t[e]--}e++}}})});$(e).data("roomcount",s)};TOOL.fix_times_and_rooms=function(e){$(e).find(".session").not(".multiroom").each(function(){TOOL.insert_timeroom(this)})};TOOL.hide_multilang_spans=function(e){var t=TOOL.extract_main_language();$(e).find("span.multilang[lang!="+t+"]").css("display","none")};TOOL.make_sessions_droppable=function(e,t){TOOL.get_items(e,t,"td.session").droppable({accept:".session",drop:function drop(){$(this).removeClass("ui-dropping");TOOL.click_session(this)},out:function out(){$(this).removeClass("ui-dropping")},over:function over(){$(this).addClass("ui-dropping")},tolerance:"pointer"})};TOOL.make_sessions_draggable=function(e,t){TOOL.get_items(e,t,".session").draggable({cursor:"move",scroll:!0,stack:".session",start:function start(){TOOL.sourcesession=this;$(this).addClass("ui-dragging");$(this).removeClass("ui-selected");$(this).data("startposition",{top:$(this).css("top"),left:$(this).css("left")})},stop:function stop(){$(this).removeClass("ui-dragging");var e=$(this).data("startposition");if(e){$(this).addClass("ui-dropping");$(this).animate({top:e.top,left:e.left},function(){$(this).removeClass("ui-dropping")})}}})};TOOL.make_sessions_selectable=function(e,t){TOOL.get_items(e,t,".session").click(function(){TOOL.click_session(this)})};TOOL.make_sessions_editable=function(e,t){TOOL.get_items(e,t,".session").each(function(){var e=$(this).prop("id");if(0==e.indexOf("id_record")){var t=TOOL.icons("session");$(this).find(".title").prepend(t)}})};TOOL.make_rooms_editable=function(e,t){TOOL.get_items(e,t,".roomheadings").each(function(){$(this).find(".timeheading").each(function(){var e=TOOL.icons("roomheadings");$(this).prepend(e)});$(this).find(".roomheading").each(function(){var e=TOOL.icons("room");$(this).prepend(e)})})};TOOL.make_slots_editable=function(e,t){TOOL.get_items(e,t,".slot").each(function(){$(this).find(".timeheading").each(function(){var e=TOOL.icons("slot"),t=document.createTextNode(" ");$(this).append(t,e)})})};TOOL.make_days_editable=function(e,t){TOOL.get_items(e,t,".tab").each(function(){TOOL.make_day_editable(this)})};TOOL.make_day_editable=function(e){var t=TOOL.icons("day"),s=document.createTextNode(" ");$(e).append(s,t)};TOOL.get_items=function(e,t,s){if(t){return $(t)}return $(e).find(s)};TOOL.set_schedule_html=function(){var e=TOOL.trim($("#schedule").html());e=e.replace(/ *\bid="yui_[^"]*"/g,"");e=e.replace(/ *\bui-[a-z0-9_-]*/g,"");e=e.replace(/ *\b(display|position|z-index): *[^;"]*;/g,"");e=e.replace(/(\b(class|style)=") +/g,"$1");e=e.replace(/ *\b(class|style)=" *"/g,"");e=e.replace(/(lang="[^"]*") (class="multilang")/g,"$2 $1");e=e.replace(/(class="multilang") (lang="[^"]*")[^>]*/g,"$1 $2");e=e.replace(/ *\bxml:\w+="[^"]*"/g,"");e=e.replace(/<span\b[^>]*class="icons"[^>]*>.*?<\/span>/g,"");e=e.replace(/<div\b[^>]*class="schedulechooser"[^>]*>.*?<\/div>/g,"");$("input[name=schedule_html]").val(e)};TOOL.set_schedule_unassigned=function(){var e=[];$("#items .session[id^=id_recordid]").each(function(){e.push($(this).prop("id").substr(12))});$("input[name=schedule_unassigned]").val(e.join(","))};TOOL.initializeschedule=function(e,t){TOOL.emptyschedule(e,t);$(TOOL.get_day_selector(t)).each(function(){})};TOOL.emptyschedule=function(e,t){$(TOOL.get_day_selector(t," .slot")).each(function(){var e=1;$(this).find(".session").each(function(){TOOL.unassign_session(this);e++;if($(this).is(":last-child")){TOOL.insert_sessions(this,e)}})});$("#items .session").not("div[id^=id_record]").each(function(){$(this).remove()})};TOOL.populateschedule=function(e){var t=TOOL.get_string("populateschedule");t=TOOL.force_single_line(t);var s="";s+="<table><tbody>";var o={selectrooms:"",day:"days",room:"rooms",selectitems:"",category:"categories",type:"types",topic:"topics",time:"times",keyword:"keywords"};for(var a in o){var n=TOOL[o[a]];if(TOOL.empty(n)){var r=HTML.tag("h4",TOOL.str[a]);s+=HTML.starttag("tr",{valign:"top"})+HTML.tag("td",r,{colspan:"3"})+HTML.endtag("tr")}else{var i=n(a,"",{size:3});if(i){s+=HTML.starttag("tr",{valign:"top"})+HTML.tag("th",TOOL.str[a])+HTML.tag("td",i,{colspan:"2"})+HTML.endtag("tr")}}}s+="</tbody></table>";var d=function(){var s=TOOL.form_values(this,"day"),o=TOOL.form_values(this,"room"),a=TOOL.form_values(this,"category"),n=TOOL.form_values(this,"type"),r=TOOL.form_values(this,"topic"),d=TOOL.form_values(this,"time"),l=TOOL.form_values(this,"keyword");if(s===void 0||null===s||""===s){s=""}else if("string"==typeof s){s=".date:contains('"+s+"')"}else{for(var m=0;m<s.length;m++){s[m]=".date:contains('"+s[m]+"')"}s=s.join(", ")}if(o===void 0||null===o||""===o){o=""}else if("string"==typeof o){o=".roomname:contains('"+TOOL.extract_roomname_txt(o)+"')"}else{for(var m=0;m<o.length;m++){o[m]=".roomname:contains('"+TOOL.extract_roomname_txt(o[m])+"')"}o=o.join(", ")}var c=$(".day");if(s){c=c.find(s).closest(".day")}c=c.find(".session");if(o){c=c.find(o).closest(".session")}c=c.filter(function(){return this.colSpan===void 0||null===this.colSpan||0===this.colSpan||1===this.colSpan}).filter(".emptysession:not(.multiroom)");if(a===void 0||null===a||""===a){a=""}else if("string"==typeof a){a=".category:contains('"+a+"')"}else{for(var m=0;m<a.length;m++){a[m]=".category:contains('"+a[m]+"')"}a=a.join(", ")}if(n===void 0||null===n||""===n){n=""}else if("string"==typeof n){n=".type:contains('"+n+"')"}else{for(var m=0;m<n.length;m++){n[m]=".type:contains('"+n[m]+"')"}n=n.join(", ")}if(r===void 0||null===r||""===r){r=""}else if("string"==typeof r){r=".topic:contains('"+r+"')"}else{for(var m=0;m<r.length;m++){r[m]=".topic:contains('"+r[m]+"')"}r=r.join(", ")}if(d===void 0||null===d||""===d){d=""}else if("string"==typeof d){d=".times .text:contains('"+d+"')"}else{for(var m=0;m<d.length;m++){d[m]=".times .text:contains('"+d[m]+"')"}d=d.join(", ")}if(l===void 0||null===l||""===l){l=""}else if("string"==typeof l){l=".keywords .text:contains('"+l+"')"}else{for(var m=0;m<l.length;m++){l[m]=".keywords .text:contains('"+l[m]+"')"}l=l.join(", ")}var p=$("#items .session");if(a){p=p.find(a).closest(".session")}if(n){p=p.find(n).closest(".session")}if(r){p=p.find(r).closest(".session")}if(d){p=p.find(d).closest(".session")}if(l){p=p.find(l).closest(".session")}for(var _=!1,h=Math.min(p.length,c.length),m=h-1;0<=m;m--){TOOL.click_session(p.get(m));TOOL.click_session(c.get(m));_=!0}TOOL.redraw_schedule(_);TOOL.open_dialog(e,t,TOOL.get_string("populatedschedule",h),TOOL.str.ok)};TOOL.show_add_dialog(e,t,s,d)};TOOL.populateschedule_old=function(e,t){TOOL.select_session();var s=$(TOOL.get_day_selector(t," .emptysession:not(.multiroom)"));if(0==s.length){return!0}var o=$("#items .session");if(0==o.length){return!0}for(var a=Math.min(o.length,s.length),n=a-1;0<=n;n--){TOOL.click_session(o.get(n));TOOL.click_session(s.get(n))}return!0};TOOL.renumberschedule=function(e,t){var s=[],o={days:$(".day").length,slots:0,rooms:0};$(".day").each(function(){var e=$(this).find(".slot").length;o.slots=Math.max(o.slots,e)});$(".day").each(function(){$(this).find(".roomheadings").each(function(){var e=$(this).find(".roomheading").length;o.rooms=Math.max(o.rooms,e)})});var a={days:Math.pow(10,Math.ceil(o.days/10)),slots:Math.pow(10,Math.ceil(o.slots/10)),rooms:Math.pow(10,Math.ceil(o.rooms/10))},n=10>o.days&&10>o.slots&&10>o.rooms,r=new RegExp("^.*("+TOOL.sessiontypes+").*$");$(TOOL.get_day_selector(t," .session:not(.emptysession):not(.demo)")).each(function(){var e=$(this).closest(".day");e=e.prop("class").replace(/^.*day(\d+).*$/,"$1");var t=$(this).prop("class").replace(r,"$1").charAt(0).toUpperCase();if(0<=this.className.indexOf("sharedsession")){var o=this.querySelectorAll(".item")}else{var o=[this]}for(var d=0;d<o.length;d++){if(n){var l=$(this).closest(".slot");l=l.prop("class").replace(/^.*slot(\d+).*$/,"$1");var m=$(this).closest(".slot").prevAll(".roomheadings");if(0==m.length||$(this).hasClass("multiroom")){var m=0}else{m=m.first().find("th, td").eq(this.cellIndex);m=m.prop("class").replace(/^.*room(\d+).*$/,"$1")}var c=e+l+m+"-"+t}else{if(TOOL.empty(s[e])){s[e]=1}else{s[e]++}var c=e*a.slots+s[e];c=c+"-"+t}$(o[d]).find(".schedulenumber").text(c)}})};TOOL.get_day_selector=function(e,t){return"."+("alldays"==e?"day":e)+(t?t:"")};TOOL.scheduleinfo_add=function(){TOOL.scheduleinfo_remove();var e={id:TOOL.pageid,action:"loadinfo"};$.getJSON(TOOL.toolroot+"/action.php",e,function(e){TOOL.info=e;TOOL.infoicons={};for(var t in TOOL.info.icons){TOOL.infoicons[t]={};for(var s in TOOL.info[t]){for(var o=TOOL.info[t][s].length,a=0;a<o;a++){var n=TOOL.info[t][s][a],r=$("#id_recordid_"+n);if(0==r.length){continue}var d=TOOL.infoicons[t][s];if(TOOL.empty(d)){var l=0;for(d in TOOL.infoicons[t]){l++}if(l>=TOOL.info.icons[t].length){d=s.charAt(0)}else{d=TOOL.info.icons[t][l]}TOOL.infoicons[t][s]=d}var m=r.find(".scheduleinfo");if(0==m.length){m=HTML.tag("div","",{class:"scheduleinfo"});m=$(m).appendTo(r)}var c=m.find("."+t);if(0==c.length){c=HTML.tag("div","",{class:t});c=$(c).appendTo(m)}var p=!1;c.find(".text").each(function(){if(this.innerHTML==s){p=!0}});if(!1==p){p=HTML.tag("span",d,{class:"icon"})+HTML.tag("span",s,{class:"text"});p=HTML.tag("span",p,{class:"icontext"});$(p).appendTo(c)}}}}})};TOOL.scheduleinfo_remove=function(){$(".scheduleinfo").remove()};TOOL.update=function(e,t){var s={id:TOOL.pageid,action:"update",type:t};$.getJSON(TOOL.toolroot+"/action.php",s,function(e){for(var s in e){for(t in e[s]){var o=$(e[s][t]),a=$("#id_recordid_"+s+" ."+t);a.find(".icons").prependTo(o);a.replaceWith(o)}}})};TOOL.add_day=function(e){var t=TOOL.str.addday,s=TOOL.position("day",$(".tabs .tab").length),o=TOOL.days("daytext"),a=TOOL.hoursmins("start",9,0),n={},r={},i={},d={};$("tbody.day").each(function(){TOOL.increment(r,$(this).find(".slot").length);$(this).find(".roomheadings").each(function(){TOOL.increment(n,$(this).find(".roomheading").length)});$(this).find(".timeheading .duration").each(function(){TOOL.increment(i,TOOL.extract_duration($(this).prop("class")))});var e=null;$(this).find(".timeheading .startfinish").each(function(){var t=$(this).text().match(/(\d+)\s*:\s*(\d+)\s*-\s*(\d+)\s*:\s*(\d+)/);if(t&&4<t.length){if("number"==typeof e){var s=60*parseInt(t[1])+parseInt(t[2]);TOOL.increment(d,Math.abs(s-e))}e=60*parseInt(t[3])+parseInt(t[4])}})});var l=TOOL.mode(n)||5,m=TOOL.mode(r)||10,c=TOOL.mode(i)||25,p=TOOL.mode(d)||5;l=TOOL.range("roomcount",l,1,Math.max(10,TOOL.max(n)));m=TOOL.range("slotcount",m,1,Math.max(20,TOOL.max(r)));c=TOOL.mins("slotlength",c,10,Math.max(120,TOOL.max(i)));p=TOOL.mins("slotinterval",p,0,Math.max(60,TOOL.max(d)));var _="";_+="<table><tbody>";_+="<tr>"+HTML.tag("th",TOOL.str.position)+HTML.tag("td",s)+"</tr>";_+="<tr>"+HTML.tag("th",TOOL.str.daytext)+HTML.tag("td",o)+"</tr>";_+="<tr>"+HTML.tag("th",TOOL.str.roomcount)+HTML.tag("td",l)+"</tr>";_+="<tr>"+HTML.tag("th",TOOL.str.slotcount)+HTML.tag("td",m)+"</tr>";_+="<tr>"+HTML.tag("th",TOOL.str.slotstart)+HTML.tag("td",a)+"</tr>";_+="<tr>"+HTML.tag("th",TOOL.str.slotlength)+HTML.tag("td",c)+"</tr>";_+="<tr>"+HTML.tag("th",TOOL.str.slotinterval)+HTML.tag("td",p)+"</tr>";_+="</tbody></table>";TOOL.show_add_dialog(e,t,_,function actionfunction(){var s=TOOL.form_value(this,"position",!0),o=TOOL.form_value(this,"daytext"),a=TOOL.form_value(this,"roomcount",!0),n=TOOL.form_value(this,"slotcount",!0),r=TOOL.form_value(this,"starthours",!0),i=TOOL.form_value(this,"startmins",!0),l=TOOL.form_value(this,"slotlength",!0),m=TOOL.form_value(this,"slotinterval",!0),c=60*parseInt(r)+parseInt(i),p=/\bday\d+/;$("table.schedule").each(function(){var e=1,t=!1;$(this).find("tbody.day").each(function(r){if(!1==t&&s<=r){t=!0;$(this).before(TOOL.day(e++,o,a,n,c,l,m))}var i=$(this).prop("class").replace(p,"");$(this).prop("class",TOOL.trim(i)+" day"+e++)});if(!1==t){t=!0;$(this).append(TOOL.day(e++,o,a,n,c,l,m))}var r=o;$(this).find(".tabs td").each(function(){var e=1,t=!1;$(this).find("div.tab").each(function(o){if(!1==t&&s<=o){t=!0;$(this).before(TOOL.tab(e++,r))}var a=$(this).prop("class").replace(p,"");$(this).prop("class",TOOL.trim(a)+" day"+e++)});if(!1==t){t=!0;$(this).append(TOOL.tab(e++,r))}})});TOOL.renumberslots(s);TOOL.set_schedule_colspan();TOOL.redraw_schedule(!0);TOOL.open_dialog(e,t,TOOL.str.addedday,TOOL.str.ok)})};TOOL.edit_day=function(e){var t=TOOL.extract_parent_tabday(this),s=$(this).closest(".tab");s.addClass("ui-selected");var o=TOOL.str.editday+TOOL.str.labelsep+t,a="";a+="<table><tbody>";var n=s.find("span.multilang");if(0==n.length){var r=s.contents().filter(TOOL.textnodes).text();a+="<tr>"+HTML.tag("th",TOOL.str.daytext)+HTML.tag("td",HTML.text("daytext",TOOL.trim(r)))+"</tr>"}else{a+="<tr>"+HTML.tag("td","")+TOOL.boldcenter("td",TOOL.str.daytext)+"</tr>";n.each(function(){var e=$(this).prop("lang");if(e){a+="<tr>"+HTML.tag("th",TOOL.str[e]?TOOL.str[e]:e)+HTML.tag("td",HTML.text("daytext_"+e,TOOL.trim($(this).html())))+"</tr>"}})}a+="</tbody></table>";a+=HTML.hidden("day",t);var i=function(){var t=TOOL.multilangs(this,"daytext"),s=TOOL.form_value(this,"day",!0);$(".tab.day"+s).each(function(){$(this).contents().not(".icons").remove();$(this).prepend(t)});$(".day.day"+s+" .date td:first-child").each(function(){$(this).contents().remove();$(this).prepend(TOOL.force_single_line(t))});$(".subcommand[id$=day"+s+"]").html(t);TOOL.open_dialog(e,o,TOOL.str.editedday,TOOL.str.ok)};TOOL.show_edit_dialog(e,o,a,i)};TOOL.remove_day=function(e){var t=TOOL.extract_parent_tabday(this),s=$(this).closest(".tab");s.addClass("ui-selected");var o=TOOL.extract_main_language(),a=s.find(".multilang[lang="+o+"]").html();if(TOOL.empty(a)){a=s.html().replace(/\s*<span[^>]*>.*?<\/span>/g,"")}a=TOOL.force_single_line(a);var n=TOOL.str.removeday+TOOL.str.labelsep+t,r=HTML.tag("p",TOOL.str.confirmday);r+=HTML.alist("ul",[a]);r+=HTML.hidden("targetday",t);TOOL.show_remove_dialog(e,n,r,function actionfunction(){var t=TOOL.form_value(this,"targetday",!0),s=1,o=!1;$(".tab[class*=day]").each(function(){var e=$(this).prop("class"),a=TOOL.extract_day(e);if(a==t){if($(this).hasClass("active")){o=!0}$(this).remove()}else{e=TOOL.trim(e.replace(/day\d+/,""));$(this).prop("class",e+" day"+s++)}});$(".day.day"+t).each(function(){$(this).find(".session").each(function(){TOOL.unassign_session(this,!0)})});if(o){$(".tab").first().trigger("click")}TOOL.set_schedule_colspan();$(".subcommand[id$=day"+t+"]").remove();TOOL.open_dialog(e,n,TOOL.str.removedday,TOOL.str.ok)})};TOOL.increment=function(e,t){if(TOOL.empty(e[t])){e[t]=1}else{e[t]++}};TOOL.mode=function(e){var t=null,s=null;for(var o in e){o=parseInt(o);if(TOOL.empty(s)||s<e[o]||s==e[o]&&t<o){s=e[o];t=o}}return TOOL.empty(t)?0:t};TOOL.max=function(e){var t=null;for(var s in e){s=parseInt(s);if(TOOL.empty(t)||t<s){t=s}}return TOOL.empty(t)?0:t};TOOL.add_roomheadings=function(e){var t=TOOL.str.addroomheadings,s="";s+="<table><tbody>";s+=TOOL.days_checkbox("days");for(var o=TOOL.extract_max_roomcount(),a=1;a<=o;a++){if(1==a){s+=TOOL.html_roomheadings_toprow()}s+=TOOL.html_roomheadings_datarow(null,a)}s+="</tbody></table>";TOOL.show_add_dialog(e,t,s,function actionfunction(){var s=TOOL.form_values(this,"days_",!0),o=TOOL.form_values(this,"room_"),a=TOOL.form_values(this,"topic_"),n=!1;$(".day").each(function(){var e=TOOL.extract_day($(this).prop("class"));if(s[e]){var t=!0;$(this).find("tr").not(".date").each(function(){if(TOOL.has_multiroom($(this))){t=!0}else if(t){if($(this).is(":not(.roomheadings)")){TOOL.roomheadings(e,o,a).insertBefore(this);n=!0}t=!1}})}});TOOL.redraw_schedule(n);TOOL.open_dialog(e,t,TOOL.str.addedroomheadings,TOOL.str.ok)})};TOOL.edit_roomheadings=function(e){var t=TOOL.extract_parent_day(this),s=TOOL.extract_parent_row(this),o=TOOL.str.editroomheadings,a="";a+="<table><tbody>";var n=1;$(this).closest("th").nextAll(".roomheading").each(function(){if(1==n){a+=TOOL.html_roomheadings_toprow()}a+=TOOL.html_roomheadings_datarow(this,n++)});if(1<n){a+=TOOL.html_roomheadings_lastrow()}a+="</tbody></table>";a+=HTML.hidden("day",t);a+=HTML.hidden("row",s);var i=!1,d=function(){var t=TOOL.form_value(this,"day",!0),s=TOOL.form_value(this,"row",!0),a=TOOL.form_values(this,"room_"),n=TOOL.form_values(this,"topic_"),r=TOOL.form_value(this,"applyto");$("tbody.day").each(function(){var e=TOOL.extract_day($(this).prop("class"));if(r==TOOL.APPLY_CURRENT||r==TOOL.APPLY_THISDAY){var o=e==t}else{var o=r==TOOL.APPLY_ALLDAYS}if(o){$(this).find(".roomheadings").each(function(){if(r==TOOL.APPLY_CURRENT){o=s==TOOL.extract_parent_row(this)}else{o=!0}if(o){$(this).replaceWith($(TOOL.html_roomheadings(t,a,n)).each(function(){TOOL.make_rooms_editable(null,this)}));i=!0}})}});TOOL.redraw_schedule(i);TOOL.open_dialog(e,o,TOOL.str.editedroomheadings,TOOL.str.ok)};TOOL.show_edit_dialog(e,o,a,d)};TOOL.remove_roomheadings=function(e){var t=TOOL.extract_parent_day(this),s=TOOL.extract_parent_row(this),o=TOOL.extract_parent_daytext(this),a=TOOL.str.removeroomheadings,n=HTML.tag("p",TOOL.str.confirmroomheadings);n+=HTML.alist("ul",[o]);n+=HTML.hidden("day",t);n+=HTML.hidden("row",s);TOOL.show_remove_dialog(e,a,n,function actionfunction(){var t=TOOL.form_value(this,"day",!0),s=TOOL.form_value(this,"row",!0);$(".day.day"+t).closest("table").find("tr:eq("+s+")").remove();TOOL.open_dialog(e,a,TOOL.str.removedroomheadings,TOOL.str.ok)})};TOOL.add_room=function(e){var t=TOOL.str.addroom,s="";s+="<table><tbody>";s+=TOOL.days_checkbox("days");var o=TOOL.position("room",TOOL.extract_max_roomcount());s+="<tr>"+HTML.tag("th",TOOL.str.position)+HTML.tag("td",o)+"</tr>";s+="<tr>"+HTML.tag("th",TOOL.str.roomname)+HTML.tag("td",TOOL.rooms("roomtxt"))+"</tr>";s+="<tr>"+HTML.tag("th",TOOL.str.roomtopic)+HTML.tag("td",HTML.text("roomtopic"))+"</tr>";s+="</tbody></table>";TOOL.show_add_dialog(e,t,s,function actionfunction(){var s=TOOL.form_values(this,"days_",!0),o=TOOL.form_value(this,"roomtxt"),a=TOOL.form_value(this,"roomtopic"),n=TOOL.form_value(this,"position",!0);$(".day").each(function(){var e=TOOL.extract_day($(this).prop("class"));if(s[e]){$(this).find(".date td").each(function(){var e=$(this).prop("colspan")||1;$(this).prop("colspan",e+1)});$(this).find(".roomheadings").each(function(){var e=0,t=!1;$(this).find(".roomheading").each(function(){e++;if(!1==t&&n<=e){t=!0;$(this).before(TOOL.roomheading(e,o,a));e++}var s=$(this).prop("class").replace(/\broom\d+/,"");$(this).prop("class",TOOL.trim(s)+" room"+e)});if(!1==t){e++;$(this).append(TOOL.roomheading(e,o,a))}});var t=HTML.tag("td","",{class:"session emptysession"});$(this).find(".slot").each(function(){var e=!1;$(this).find(".session").each(function(){var s=$(this).data("room");if(!1==e){if(this.colSpan&&1<this.colSpan){$(this).prop("colspan",this.colSpan+1);e=!0}else if(n<=s){TOOL.insert_session(t,"insertBefore",this);e=!0}}});if(!1==e){e=!0;TOOL.insert_session(t,"appendTo",this)}})}});TOOL.set_schedule_colspan();TOOL.redraw_schedule(!1);TOOL.open_dialog(e,t,TOOL.str.addedroom,TOOL.str.ok)})};TOOL.edit_room=function(e){var t=TOOL.extract_parent_day(this),s=TOOL.extract_parent_room(this),o=[],a={},n=$(this).closest(".roomheading");n.addClass("ui-selected");for(var r in TOOL.details){var d=n.find("."+r);if(0==d.length){continue}a[r]={};var l=d.find("span.multilang");if(0==l.length){a[r]=d.text();continue}l.each(function(){var e=$(this).prop("lang");if(e){if(0>o.indexOf(e)){o.push(e)}a[r][e]=$(this).text()}})}var m=TOOL.str.editroom+TOOL.str.labelsep+s,c="";c+="<table><tbody>";if(o.length){c+="<tr>"+HTML.tag("td","");for(var p=0;p<o.length;p++){var _=o[p],h=TOOL.str[_]?TOOL.str[_]:_;c+=TOOL.boldcenter("td",h)}c+="</tr>"}for(var r in a){c+="<tr>"+HTML.tag("th",TOOL.str[r]);if(0==o.length){var u=TOOL.trim(a[r]);c+=HTML.tag("td",HTML.text(r,u,12))}else{for(var p=0;p<o.length;p++){var _=o[p],u="";if("string"==typeof a[r]){u=TOOL.trim(a[r])}else if(a[r][_]){u=TOOL.trim(a[r][_])}c+=HTML.tag("td",HTML.text(r+"_"+_,u))}}c+="</tr>"}c+="</tbody></table>";c+=HTML.hidden("day",t);c+=HTML.hidden("room",s);var g=function(){var t=TOOL.form_value(this,"day",!0),s=TOOL.form_value(this,"room",!0),o=$(".day"+t+" .roomheading.room"+s),a=$(".day"+t+" .session .room"+s);for(var n in TOOL.details){var r=TOOL.multilangs(this,n);o.find("."+n).html(r);a.find("."+n).html(r)}TOOL.open_dialog(e,m,TOOL.str.editedroom,TOOL.str.ok)};TOOL.show_edit_dialog(e,m,c,g)};TOOL.remove_room=function(e){var t=TOOL.extract_parent_day(this),s=TOOL.extract_parent_room(this),o=TOOL.extract_parent_daytext(this),a=$(this).closest(".roomheading");a.addClass("ui-selected");var n=TOOL.str.removeroom+TOOL.str.labelsep+s,r=HTML.tag("p",TOOL.str.confirmroom);r+="<table><tbody>";r+="<tr>"+HTML.tag("th",TOOL.str.day)+HTML.tag("td",o)+"</tr>";for(var i in TOOL.details){var d=a.find("."+i);if(d.html()){r+="<tr>"+HTML.tag("th",TOOL.str[i])+HTML.tag("td",d.html())+"</tr>"}}r+="</tbody></table>";r+=HTML.hidden("day",t);r+=HTML.hidden("room",s);TOOL.show_remove_dialog(e,n,r,function actionfunction(){var t=TOOL.form_value(this,"day",!0),s=TOOL.form_value(this,"room",!0),o=".day"+t+" .date td",a=".day"+t+" .roomheading.room"+s,r=$(a).index();$(a).remove();var i=0;$(".day"+t+" .slot").each(function(){var e=0,t=!1;$(this).find("th, td").each(function(){if(t){e++;return!0}if(this.colSpan&&1<this.colSpan){var s=this.colSpan-1;if(1==s){$(this).removeAttr("colspan")}else{$(this).prop("colspan",s)}e+=s;t=!0;return!0}if($(this).index()==r){TOOL.unassign_session(this,!0);t=!0;return!0}e++});i=Math.max(i,e)});if(1<i){$(o).prop("colspan",i)}else{$(o).removeAttr("colspan")}TOOL.set_schedule_colspan();TOOL.open_dialog(e,n,TOOL.str.removedroom,TOOL.str.ok)})};TOOL.add_slot=function(e){var t=TOOL.str.addslot,s=TOOL.hoursmins("start"),o=TOOL.hoursmins("finish"),a=TOOL.days_select("targetday"),n="";n+="<table><tbody>";n+="<tr>"+HTML.tag("th",TOOL.str.day)+HTML.tag("td",a)+"</tr>";n+="<tr>"+HTML.tag("th",TOOL.str.starttime)+HTML.tag("td",s)+"</tr>";n+="<tr>"+HTML.tag("th",TOOL.str.finishtime)+HTML.tag("td",o)+"</tr>";n+="</tbody></table>";TOOL.show_add_dialog(e,t,n,function actionfunction(){var s=TOOL.form_value(this,"targetday",!0),o=TOOL.form_value(this,"starthours",!0),a=TOOL.form_value(this,"startmins",!0),n=TOOL.form_value(this,"finishhours",!0),r=TOOL.form_value(this,"finishmins",!0),i=TOOL.form_duration(o,a,n,r),d=TOOL.form_startfinish(o,a,n,r),l=TOOL.slot(s,d,i);$(".day.day"+s).find(".slot").each(function(){var e=$(this).find(".timeheading .startfinish").text();if(e>d){l.insertBefore(this);l=null}return TOOL.empty(l)?!1:!0});if(l){$(".day.day"+s).append(l);l=null}TOOL.redraw_schedule(!0);TOOL.renumberslots(s);TOOL.open_dialog(e,t,TOOL.str.addedslot,TOOL.str.ok)})};TOOL.edit_slot=function(e){var t=TOOL.extract_parent_day(this),o=TOOL.extract_parent_slot(this),a=TOOL.extract_parent_daytext(this),n=$(this).closest(".timeheading");n.addClass("ui-selected");var r=n.find(".startfinish").text(),i=/^.*(\d{2}).*(\d{2}).*(\d{2}).*(\d{2}).*$/,d=parseInt(r.replace(i,"$1")),l=parseInt(r.replace(i,"$2")),m=parseInt(r.replace(i,"$3")),c=parseInt(r.replace(i,"$4")),p=".day"+t+" .slot"+o,_=$(p),s=TOOL.str.editslot,h=TOOL.hoursmins("start",d,l),u=TOOL.hoursmins("finish",m,c),g=HTML.checkbox("multiroom",TOOL.has_multiroom(_))+" "+TOOL.rooms("roomtxt",f),f=TOOL.extract_sessionroom(p+" .multiroom","name"),y="";y+="<table><tbody>";y+="<tr>"+HTML.tag("th",TOOL.str.day)+HTML.tag("td",a)+"</tr>";y+="<tr>"+HTML.tag("th",TOOL.str.starttime)+HTML.tag("td",h)+"</tr>";y+="<tr>"+HTML.tag("th",TOOL.str.finishtime)+HTML.tag("td",u)+"</tr>";y+="<tr>"+HTML.tag("th",TOOL.str.largeroom)+HTML.tag("td",g)+"</tr>";y+="</tbody></table>";y+=HTML.hidden("day",t);y+=HTML.hidden("slot",o);TOOL.show_edit_dialog(e,s,y,function actionfunction(){var t=TOOL.form_value(this,"day",!0),o=TOOL.form_value(this,"roomtxt"),a=TOOL.form_value(this,"multiroom",!0),n=TOOL.form_value(this,"starthours",!0),i=TOOL.form_value(this,"startmins",!0),d=TOOL.form_value(this,"finishhours",!0),l=TOOL.form_value(this,"finishmins",!0),m=TOOL.form_duration(n,i,d,l),c=TOOL.form_startfinish(n,i,d,l);$(p+" .startfinish").html(c);$(p+" .duration").html(TOOL.get_string("durationtxt",m));var _=$(p).prop("class").replace(/\bduration\w+/,"");$(p).prop("class",_+" duration"+m);var h=1,u=!0,g=TOOL.extract_roomcount(t);$(p+" .session").each(function(){if(a){if(u){u=!1;$(this).addClass("multiroom");if(1<g){$(this).prop("colspan",g)}TOOL.insert_timeroom(this,o)}else{TOOL.unassign_session(this,!0)}}else{if($(this).is(".multiroom")){$(this).removeClass("multiroom")}if(this.colSpan){$(this).removeAttr("colspan")}if($(this).is(":not(.emptysession)")){TOOL.insert_timeroom(this)}else{$(this).find(TOOL.sessiontimeroom).remove()}h++;if($(this).is(":last-child")){TOOL.insert_sessions(this,h,t)}}});TOOL.open_dialog(e,s,TOOL.str.editedslot,TOOL.str.ok)})};TOOL.remove_slot=function(e){var t=TOOL.extract_parent_day(this),s=TOOL.extract_parent_slot(this),o=TOOL.extract_parent_daytext(this),a=".day"+t+" .slot"+s,n=$(a+" .timeheading");n.addClass("ui-selected");var r=n.find(".startfinish").text(),i=n.find(" .duration").html(),d=TOOL.str.removeslot+TOOL.str.labelsep+s,l=HTML.tag("p",TOOL.str.confirmslot);l+="<table><tbody>";l+="<tr>"+HTML.tag("th",TOOL.str.day)+HTML.tag("td",o)+"</tr>";l+="<tr>"+HTML.tag("th",TOOL.str.time)+HTML.tag("td",r)+"</tr>";l+="<tr>"+HTML.tag("th",TOOL.str.duration)+HTML.tag("td",i)+"</tr>";l+="</tbody></table>";l+=HTML.hidden("day",t);l+=HTML.hidden("slot",s);TOOL.show_remove_dialog(e,d,l,function actionfunction(){var t=TOOL.form_value(this,"day",!0);$(a+" .session").each(function(){TOOL.unassign_session(this,!0)});$(a).remove();TOOL.renumberslots(t);TOOL.open_dialog(e,d,TOOL.str.removedslot,TOOL.str.ok)})};TOOL.redraw_schedule=function(e){if(e){$("#schedule").hide().show(50)}};TOOL.set_schedule_colspan=function(e){if(TOOL.empty(e)){e=TOOL.extract_max_roomcount()+1}$(".scheduletitle, .tabs").find("td").prop("colspan",e)};TOOL.renumberslots=function(e){var t=0;$(".day.day"+e).find(".slot").each(function(){$(this).prop("class","slot slot"+t++)})};TOOL.edit_session=function(e){var t=$(this).closest(".session"),s=HTML.text("title",t.find(".title").text(),50),o=HTML.text("authornames",t.find(".authornames").html(),50),a=HTML.text("schedulenumber",t.find(".schedulenumber").text(),5),n=TOOL.categories("category",t.find(".category").html()),r=TOOL.types("type",t.find(".type").html()),i=TOOL.topics("topic",t.find(".topic").html()),d=TOOL.range("rowspan",t.prop("rowspan")),l=TOOL.range("colspan",t.prop("colspan")),m=HTML.hidden("id",t.prop("id")),c="";c+="<table><tbody>";c+="<tr>"+HTML.tag("th",TOOL.str.title)+HTML.tag("td",s)+"</tr>";c+="<tr>"+HTML.tag("th",TOOL.str.authornames)+HTML.tag("td",o)+"</tr>";c+="<tr>"+HTML.tag("th",TOOL.str.schedulenumber)+HTML.tag("td",a)+"</tr>";c+="<tr>"+HTML.tag("th",TOOL.str.category)+HTML.tag("td",n)+"</tr>";c+="<tr>"+HTML.tag("th",TOOL.str.type)+HTML.tag("td",r)+"</tr>";c+="<tr>"+HTML.tag("th",TOOL.str.topic)+HTML.tag("td",i)+"</tr>";if(t.parent().hasClass("slot")){c+="<tr>"+HTML.tag("th",TOOL.str.rowspan)+HTML.tag("td",d)+"</tr>";c+="<tr>"+HTML.tag("th",TOOL.str.colspan)+HTML.tag("td",l)+"</tr>"}c+="</tbody></table>";c+=m;TOOL.select_session(m);TOOL.show_edit_dialog(e,TOOL.str.editsession,c,function actionfunction(){var t=TOOL.form_value(this,"id"),s=TOOL.form_value(this,"title"),o=TOOL.form_value(this,"authornames"),a=TOOL.form_value(this,"schedulenumber"),n=TOOL.form_value(this,"category"),r=TOOL.form_value(this,"type"),i=TOOL.form_value(this,"topic"),d=TOOL.form_value(this,"rowspan",!0),l=TOOL.form_value(this,"colspan",!0),m=$("#"+t);m.find(".title").contents().filter(TOOL.textnodes).remove();m.find(".title").append(s);m.find(".authornames").html(o);m.find(".schedulenumber").text(a);m.find(".category").html(n);m.find(".type").html(r);m.find(".topic").html(i);TOOL.change_rowspan_colspan(m,d,l);TOOL.open_dialog(e,TOOL.str.editsession,TOOL.str.editedsession,TOOL.str.ok)})};TOOL.remove_session=function(e){var t=$(this).closest(".session").prop("id"),s=TOOL.extract_recordid(t),o=TOOL.str.removesession+": rid="+s,a=HTML.tag("p",TOOL.str.confirmsession);TOOL.select_session(t);TOOL.show_remove_dialog(e,o,a,function actionfunction(){var s=TOOL.item(null,"session emptysession").appendTo("#items");TOOL.select_session();TOOL.click_session(s);TOOL.click_session(document.getElementById(t),!0);TOOL.open_dialog(e,o,TOOL.str.removedsession,TOOL.str.ok)})};TOOL.select_session=function(e){if(TOOL.sourcesession){TOOL.click_session(TOOL.sourcesession)}else{$(".ui-selected").removeClass("ui-selected")}if(e){TOOL.click_session(document.getElementById(e))}};TOOL.click_session=function(e,t){if(TOOL.empty(TOOL.sourcesession)){TOOL.sourcesession=e;$(e).addClass("ui-selected");return!0}var s=$(e).hasClass("emptysession"),o=$(TOOL.sourcesession).hasClass("emptysession");if(TOOL.sourcesession==e||o&&s){$(TOOL.sourcesession).removeClass("ui-selected");$(e).removeClass("ui-selected");TOOL.sourcesession=null;return!0}var a=$(e).hasClass("multiroom"),n=$(TOOL.sourcesession).hasClass("multiroom"),r=$(e).closest("table.schedule").length,i=$(TOOL.sourcesession).closest("table.schedule").length,d=t?!0:!1;if(!1==s&&!1==o){d=!0}if(e.tagName==TOOL.sourcesession.tagName){d=!0}if(d){$(e).addClass("ui-selected");var l=document.createElement("DIV"),m=document.createElement("DIV"),c=$(TOOL.sourcesession).prop("id"),p=$(e).prop("id");$(TOOL.sourcesession).prop("id",p);$(e).prop("id",c);var _=TOOL.get_non_jquery_classes(TOOL.sourcesession),h=TOOL.get_non_jquery_classes(e);$(TOOL.sourcesession).removeClass(_).addClass(h);$(e).removeClass(h).addClass(_);if(i){if(s&&!1==n){$(TOOL.sourcesession).children(TOOL.sessiontimeroom).remove()}else{$(TOOL.sourcesession).children(TOOL.sessiontimeroom).appendTo(m)}}if(!1==s){$(e).children(TOOL.sessioncontent).appendTo(m)}if(r){if(o&&!1==a){$(e).children(TOOL.sessiontimeroom).remove()}else{$(e).children(TOOL.sessiontimeroom).appendTo(l)}}if(!1==o){$(TOOL.sourcesession).children(TOOL.sessioncontent).appendTo(l)}$(l).children().appendTo(e);$(m).children().appendTo(TOOL.sourcesession);if(i){if(n){$(TOOL.sourcesession).addClass("multiroom")}else{$(TOOL.sourcesession).removeClass("multiroom");if(!1==s){TOOL.insert_timeroom(TOOL.sourcesession)}}}if(r){if(a){$(e).addClass("multiroom")}else{$(e).removeClass("multiroom");if(!1==s){TOOL.insert_timeroom(e)}}}m=null;l=null;$(TOOL.sourcesession).removeClass("ui-selected");TOOL.sourcesession=null;$(e).removeClass("ui-selected");return!0}var u=null,g=null;if(o&&!1==s){u=TOOL.sourcesession;g=e}if(!1==o&&s){u=e;g=TOOL.sourcesession}if(u&&g){$(u).addClass("ui-selected");$(u).prop("id",$(g).prop("id"));var f=$(u).is(".multiroom"),y=TOOL.get_non_jquery_classes(u),x=TOOL.get_non_jquery_classes(g);$(u).removeClass(y).addClass(x);if(f){$(u).addClass("multiroom");$(u).children().not(TOOL.sessiontimeroom).remove()}else{$(u).removeClass("multiroom");$(u).children().remove();TOOL.insert_timeroom(u)}$(g).children(TOOL.sessioncontent).appendTo(u);$(u).removeClass("ui-selected");$(g).remove();TOOL.sourcesession=null;return!0}};TOOL.show_add_dialog=function(e,t,s,o){TOOL.open_dialog(e,t,s,TOOL.str.add,null,o,!0)};TOOL.show_edit_dialog=function(e,t,s,o){TOOL.open_dialog(e,t,s,TOOL.str.update,null,o,!0)};TOOL.show_remove_dialog=function(e,t,s,o){TOOL.open_dialog(e,t,s,TOOL.str.remove,null,o,!0)};TOOL.open_dialog=function(e,t,s,o,a,n,r){var i=document.getElementById(TOOL.dialogid);if(TOOL.empty(i)){i=document.createElement("DIV");i.setAttribute("id",TOOL.dialogid);$("body").append(i)}var d=$(i);if(TOOL.empty(d.dialog("instance"))){d.dialog({autoOpen:!1,close:TOOL.select_session,width:"auto"})}else{if(d.dialog("isOpen")){d.dialog("close")}}d.dialog("option","title",t);d.html(s);d.dialog("option","modal",r);var l=[];if(TOOL.empty(o)){o=TOOL.str.ok}if(TOOL.empty(a)){a="ui-icon-check"}if(TOOL.empty(n)){n=function(){$(this).dialog("close")}}l.push({text:o,click:n});if(r){var m=TOOL.str.cancel,c=function(){$(this).dialog("close");TOOL.select_session()};l.push({text:m,click:c})}d.dialog("option","buttons",l);d.dialog("open");e.stopPropagation()};TOOL.close_dialog=function(){$("#"+TOOL.dialogid).dialog("close")};TOOL.has_multiroom=function(e){return 0<e.find(".session").filter(TOOL.colspan).length};TOOL.extract_main_language=function(){return $("body").attr("class").match(/lang-(\w+)/)[1]};TOOL.extract_parent_daytext=function(e){var t=$(e).closest(".day").find(".date td");if(0==t.length){return""}return TOOL.force_single_line(t.first().html())};TOOL.extract_parent_row=function(e){return $(e).closest("tr").prop("rowIndex")};TOOL.extract_parent_day=function(e){return TOOL.extract_parent_number(e,"day","day")};TOOL.extract_parent_tabday=function(e){return TOOL.extract_parent_number(e,"tab","day")};TOOL.extract_parent_room=function(e){return TOOL.extract_parent_number(e,"roomheading","room")};TOOL.extract_parent_slot=function(e){return TOOL.extract_parent_number(e,"slot","slot")};TOOL.extract_parent_number=function(e,t,s){var o=$(e).closest("."+t).prop("class");return TOOL.extract_type_number(o,s)};TOOL.extract_recordid=function(e){return TOOL.extract_number(e,"id_recordid_","")};TOOL.extract_active_day=function(){return TOOL.extract_day($(".tab.active").prop("class"))};TOOL.extract_day=function(e){return TOOL.extract_type_number(e,"day")};TOOL.extract_room=function(e){return TOOL.extract_type_number(e,"room")};TOOL.extract_slot=function(e){return TOOL.extract_type_number(e,"slot")};TOOL.extract_duration=function(e){return TOOL.extract_number(e,".*\\bduration","\\b.*")};TOOL.extract_type_number=function(e,t){return TOOL.extract_number(e,".*\\b"+t,"\\b.*")};TOOL.extract_number=function(e,t,s){if("string"==typeof e){var o=e.replace(new RegExp("^"+t+"(\\d+)"+s+"$"),"$1");return isNaN(o)?0:parseInt(o)}return 0};TOOL.extract_roomcount=function(e){return $(".day.day"+e).data("roomcount")};TOOL.extract_max_roomcount=function(e){var t=0,s=".day";if(e){s+=".day"+e}$(s).each(function(){var e=TOOL.extract_parent_day(this);t=Math.max(t,TOOL.extract_roomcount(e))});return t};TOOL.extract_roomname_txt=function(e){return TOOL.extract_room_txt(e)};TOOL.extract_roomseats_txt=function(e){return TOOL.extract_room_txt(e,!0)};TOOL.extract_room_txt=function(e,t){if(e==TOOL.trim(e)){if(0>e.indexOf("class=\"multilang\"")){var s=/^(.*)\((.*?)\)(.*?)$/,o=/^(.*)（(.*?)）(.*?)$/,a=t?"$2":"$1$3"}else{var s=/(<span[^>]*>)([^<]*?)\((.*?)\)(.*?)(<\/span>)/,o=/(<span[^>]*>)([^<]*?)（(.*?)）(.*?)(<\/span>)/,a=t?"$1$3$5":"$1$2$4$5"}e=e.replace(s,a).replace(o,a)}return e};TOOL.extract_startfinish_html=function(e,t){return TOOL.extract_time_html(e,t,"startfinish")};TOOL.extract_duration_html=function(e,t){return TOOL.extract_time_html(e,t,"duration")};TOOL.extract_time_html=function(e,t,s){return $(".day.day"+e+" .slot"+t+" .timeheading ."+s).html()};TOOL.extract_roomname_html=function(e,t){return TOOL.extract_room_html(e,t,"roomname")};TOOL.extract_roomseats_html=function(e,t){return TOOL.extract_room_html(e,t,"roomseats")};TOOL.extract_roomtopic_html=function(e,t){return TOOL.extract_room_html(e,t,"roomtopic")};TOOL.extract_room_html=function(e,t,s){return $(".day.day"+e+" .roomheadings .room"+t+" ."+s).html()};TOOL.extract_sessionroom=function(e,t){var s=[];if(i){s.push(i)}else{s.push("name","seats","topic")}var o={},a=TOOL.extract_main_language();for(var n in s){var r="",i=s[n],d="extract_room"+i+"_txt";if(e){var l=$(e).find(".room"+i);if(l.length){if(l.find("span.multilang").length){l=l.find("span.multilang");if(l.find("[lang="+a+"]").length){l=l.find("[lang="+a+"]")}}r=l.first().html();if(TOOL[d]){r=TOOL[d](r)}}}o[i]=r}if(t){return o[t]}else{return o}};TOOL.colspan=function(){return this.colSpan&&1<this.colSpan};TOOL.textnodes=function(){return this.nodeType&&3===this.nodeType};TOOL.change_rowspan_colspan=function(e,t,s){var o=e.prop("cellIndex"),a=e.prop("rowspan"),n=e.prop("colspan");if(a==t){return!0}if(n===void 0){n=0}if(s===void 0){s=0}if(a<t){var r=0;e.closest("tr").nextAll().each(function(){r++;if(r<a){return!0}if(r>=t){return!1}$(this).find("th, td").eq(o).each(function(){TOOL.unassign_session(this,!0)})})}if(a>t){var r=0;e.closest("tr").nextAll().each(function(){r++;if(r<t){return!0}if(r>=a){return!1}var s=TOOL.html_sessions(o,o);if(e.is(":last-child")){$(this).append(s)}else{$(this).find("th, td").eq(o).each(function(){TOOL.insert_session(s,"insertBefore",this)})}})}e.prop("rowspan",t)};TOOL.unassign_session=function(e,t){var s=$(e).prop("id");if(0==s.indexOf("id_recordid_")){$(e).removeAttr("id");TOOL.item(s,TOOL.get_non_jquery_classes(e)).append($(e).children(TOOL.sessioncontent)).appendTo("#items")}if(t){$(e).remove()}else{$(e).children().remove();TOOL.insert_timeroom(e);$(e).removeAttr("id colspan").removeClass("demo attending multiroom").addClass("emptysession")}};TOOL.insert_sessions=function(e,t,s,o){if(TOOL.empty(s)){s=TOOL.extract_parent_day(e)}if(TOOL.empty(o)){o=TOOL.extract_roomcount(s)}if(t<=o){var a=TOOL.html_sessions(t,o);TOOL.insert_session(a,"insertAfter",e)}};TOOL.insert_session=function(e,t,s){$(e).each(function(){TOOL.make_sessions_editable(null,this);TOOL.make_sessions_droppable(null,this);TOOL.make_sessions_draggable(null,this);TOOL.make_sessions_selectable(null,this)})[t](s)};TOOL.insert_timeroom=function(e,t){var s=TOOL.extract_parent_day(e),o=TOOL.extract_parent_slot(e),a=$(e).data("room");if(TOOL.empty(a)){a=$(e).index()}TOOL.insert_time(e,s,o);TOOL.insert_room(e,s,a,t)};TOOL.insert_time=function(e,t,s){var o=TOOL.html_time(t,s);if($(e).find(".time").length){$(e).find(".time").replaceWith(o)}else{$(e).prepend(o)}};TOOL.insert_room=function(e,t,s,o){var a=TOOL.html_room(t,s,o);if($(e).find(".room").length){$(e).find(".room").replaceWith(a)}else if($(e).find(".time").length){$(e).find(".time").after(a)}else{$(e).prepend(a)}};TOOL.get_non_jquery_classes=function(e){for(var t=$(e).prop("class").split(/\s+/),s=t.length-1,o=s;0<=o;o--){if(0==t[o].indexOf("ui-")){t.splice(o,1)}}return t.join(" ")};TOOL.tab=function(e,t){var s=TOOL.html_tab(e,t);return $(s).each(function(){TOOL.make_day_editable(this)})};TOOL.day=function(e,t,s,o,a,n,r){var i=TOOL.html_day(e,t,s,o,a,n,r);return $(i).each(function(){TOOL.make_day_editable(this)})};TOOL.roomheadings=function(e,t,s){var o=$(".day.day"+e+" .roomheadings");if(o.length){return o.first().clone()}o=$(TOOL.html_roomheadings(e,t,s));TOOL.make_rooms_editable(null,o);return o};TOOL.roomheading=function(e,t,s){var o=TOOL.extract_roomname_txt(t),a=TOOL.extract_roomseats_txt(t),n=$(TOOL.html_roomheading(e,o,a,s));n.prepend(TOOL.icons("room"));return n};TOOL.slot=function(e,t,s){var o=$(TOOL.html_slot(e,t,s,TOOL.extract_roomcount(e)));TOOL.make_slots_editable(null,o);TOOL.make_sessions_droppable(o);TOOL.make_sessions_draggable(o);TOOL.make_sessions_selectable(o);return o};TOOL.item=function(e,t){var s=$(TOOL.html_item(e,t));TOOL.make_sessions_draggable(null,s);TOOL.make_sessions_selectable(null,s);return s};TOOL.icons=function(e,t){var s=document.createElement("SPAN");s.setAttribute("class","icons");if(TOOL.empty(t)){t=["edit","remove"]}else if("string"==typeof t){t=[t]}for(var o in t){var a=t[o],n=a+"_"+e,r=document.createElement("IMG");r.setAttribute("src",TOOL["icon"+a]);r.setAttribute("title",TOOL.str[a+e]);r.setAttribute("class","icon");r.setAttribute("clickhandler",n);if(TOOL[n]){$(r).click(TOOL[n])}else{$(r).click(TOOL.noclickhandler)}s.appendChild(r)}return s};TOOL.noclickhandler=function(){alert("Oops, click handler is missing: TOOL."+this.getAttribute("clickhandler")+"()")};TOOL.html_day=function(e,t,o,a,n,r,i){var d="";d+=HTML.starttag("tbody",{class:"day day"+e});d+=HTML.starttag("tr",{class:"date"});d+=HTML.tag("td",t,{colspan:o});d+=HTML.endtag("tr");d+=TOOL.html_roomheadings(e,null,null,o);for(var l=null,m=null,c=null,p=1;p<=a;p++){if(TOOL.empty(l)){l=n}else{l=m+i}m=l+r;c=TOOL.form_startfinish(Math.floor(l/60),l%60,Math.floor(m/60),m%60);d+=TOOL.html_slot(e,c,r,o)}d+=HTML.endtag("tbody");return d};TOOL.html_tab=function(e,t){return HTML.tag("div",t,{class:"tab day"+e})};TOOL.html_roomheadings_toprow=function(){return HTML.starttag("tr")+HTML.tag("td","")+TOOL.boldcenter("td",TOOL.str.room)+TOOL.boldcenter("td",TOOL.str.roomtopic)+HTML.endtag("tr")};TOOL.html_roomheadings_datarow=function(e,t){var s=TOOL.extract_sessionroom(e);return HTML.starttag("tr")+HTML.tag("th",t)+HTML.tag("td",TOOL.rooms("room_"+t,s.name))+HTML.tag("td",HTML.text("topic_"+t,s.topic))+HTML.endtag("tr")};TOOL.html_roomheadings_lastrow=function(){var e={};e[TOOL.APPLY_CURRENT]=TOOL.str.currentheadings;e[TOOL.APPLY_THISDAY]=TOOL.str.allheadingsthisday;e[TOOL.APPLY_ALLDAYS]=TOOL.str.allheadingsalldays;return HTML.starttag("tr")+HTML.tag("th",TOOL.str.applyto)+HTML.tag("td",HTML.select("applyto",e,TOOL.APPLY_CURRENT,{}))+HTML.endtag("tr")};TOOL.html_roomheading=function(e,t,s,o){return HTML.starttag("th",{class:"roomheading room"+e})+HTML.tag("span",t,{class:"roomname"})+HTML.tag("span",s,{class:"roomseats"})+HTML.tag("div",o,{class:"roomtopic"})+HTML.endtag("th")};TOOL.html_roomheadings=function(e,t,s,o){if(TOOL.empty(o)){o=TOOL.extract_roomcount(e)}var a="";a+=HTML.starttag("tr",{class:"roomheadings"});a+=HTML.tag("th","",{class:"timeheading"});for(var n=1;n<=o;n++){if(TOOL.empty(t)||TOOL.empty(t[n])||"0"==t[n]){var i=TOOL.str.roomname+" ("+n+")",d=40,l=TOOL.str.roomtopic+" ("+n+")"}else{var i=TOOL.extract_roomname_txt(t[n]),d=TOOL.extract_roomseats_txt(t[n]),l=TOOL.trim(s[n])}a+=TOOL.html_roomheading(n,i,d,l)}a+=HTML.endtag("tr");return a};TOOL.html_timeroom=function(e,t,s,o){return TOOL.html_time(e,t)+TOOL.html_room(e,s,o)};TOOL.html_time=function(e,t){var s=TOOL.extract_startfinish_html(e,t),o=TOOL.extract_duration_html(e,t),a=HTML.tag("span",s,{class:"startfinish"})+HTML.tag("span",o,{class:"duration"});return HTML.tag("div",a,{class:"time"})};TOOL.html_room=function(e,t,s){if("0"==s){return""}if(TOOL.empty(s)){var o=TOOL.extract_roomname_html(e,t),a=TOOL.extract_roomseats_html(e,t),n=TOOL.extract_roomtopic_html(e,t)}else{var o=TOOL.extract_roomname_txt(s),a=TOOL.extract_roomseats_txt(s),n=""}var r=HTML.tag("span",o,{class:"roomname"})+HTML.tag("span",a,{class:"roomseats"})+HTML.tag("div",n,{class:"roomtopic"});return HTML.tag("div",r,{class:"room"})};TOOL.html_item=function(e,t){if(TOOL.empty(t)){t="session"}var s={class:t};if(e){s.id=e}return HTML.tag("div","",s)};TOOL.html_sessions=function(e,t){for(var s="",o=e;o<=t;o++){s+=HTML.tag("td","",{class:"session emptysession"})}return s};TOOL.html_slot=function(e,t,s,o){var a="",n=TOOL.get_string("durationtxt",s);a+=HTML.starttag("tr",{class:"slot duration"+s});a+=HTML.starttag("td",{class:"timeheading"});a+=HTML.tag("span",t,{class:"startfinish"});a+=HTML.tag("span",n,{class:"duration"});a+=HTML.endtag("td");a+=TOOL.html_sessions(1,o);a+=HTML.endtag("tr");return a};TOOL.get_string=function(e,t){if(TOOL.empty(e)||TOOL.empty(TOOL.str[e])){return""}var s=TOOL.str[e];if(t||0===t){if("string"==typeof t||"number"==typeof t){var o=/\{\$a\}/g;s=TOOL.str[e].replace(o,t)}else{for(var n in t){var o=new RegExp("\\{\\$a->"+n+"\\}","g");s=s.replace(o,t[n])}}}return s};TOOL.hours=function(e,t,s,o,a){var n=TOOL.empty(s)&&TOOL.empty(o);if(TOOL.empty(s)){s=0}if(TOOL.empty(o)){o=23}if(TOOL.empty(a)){a={}}if(TOOL.empty(a.class)){a.class="select"+e}for(var r={},d=s;d<=o;d++){if(n){r[d]=TOOL.pad(d)}else{r[d]=TOOL.get_string("numhours",d)}}return HTML.select(e,r,t,a)};TOOL.mins=function(e,t,s,o,a){var n=TOOL.empty(s)&&TOOL.empty(o);if(TOOL.empty(s)){s=0}if(TOOL.empty(o)){o=59}if(TOOL.empty(a)){a={}}if(TOOL.empty(a.class)){a.class="select"+e}for(var r={},d=s;d<=o;d+=5){if(n){r[d]=TOOL.pad(d)}else{r[d]=TOOL.get_string("nummins",d)}}return HTML.select(e,r,t,a)};TOOL.hoursmins=function(e,t,s){var t=TOOL.hours(e+"hours",t),s=TOOL.mins(e+"mins",s);return t+" : "+s};TOOL.range=function(e,t,s,o,a){if(TOOL.empty(e)){return""}if(TOOL.empty(s)){s=1}if(TOOL.empty(o)){o=10}if(TOOL.empty(t)){t=o}if(TOOL.empty(a)){a={}}if(a.class){a.class="select"+e}for(var n={},r=s;r<=o;r++){n[r]=r}return HTML.select(e,n,t,a)};TOOL.position=function(e,t,s,o){if(e){e=TOOL.get_string(e).toLowerCase()}if(TOOL.empty(s)){s="position"}if(TOOL.empty(o)){o={}}for(var n={},r=1;r<=t;r++){if(TOOL.empty(e)){n[r]=r}else{var d={type:e,num:r};n[r]=TOOL.get_string("positionbefore",d)}}n[r]=TOOL.str.positionlast;return HTML.select(s,n,r,o)};TOOL.days_select=function(e){var t=TOOL.extract_active_day(),s=TOOL.extract_main_language(),o={};$(".tab").each(function(){var e=TOOL.extract_day($(this).prop("class")),t=$(this).find("span.multilang[lang="+s+"]");if(t.length){t=t.html()}else{t=$(this).html()}o[e]=TOOL.force_single_line(t)});return HTML.select(e,o,t,{})};TOOL.days_checkbox=function(e){var t="",s=TOOL.str.day,o=TOOL.extract_active_day();$(".day").each(function(){var a=TOOL.extract_parent_day(this),n=e+"_"+a,r=TOOL.extract_parent_daytext(this);r=HTML.tag("label",r,{for:"id_"+n});r=HTML.checkbox(n,a==o)+" "+r;t+=HTML.starttag("tr",{valign:"top"})+HTML.tag("th",s)+HTML.tag("td",r,{colspan:"2"})+HTML.endtag("tr");s=""});return t};TOOL.days=function(e,t,s){return TOOL.clone_menu("schedule_day",e,t,s)};TOOL.rooms=function(e,t,s){return TOOL.clone_menu("schedule_roomname",e,t,s)};TOOL.categories=function(e,t,s){return TOOL.clone_menu("presentation_category",e,t,s)};TOOL.types=function(e,t,s){return TOOL.clone_menu("presentation_type",e,t,s)};TOOL.topics=function(e,t,s){return TOOL.clone_menu("presentation_topic",e,t,s)};TOOL.clone_menu=function(e,t,s,o){var a=$("select[name="+e+"]");if(0==a.length){return""}a=a.first().clone();return TOOL.dialog_menu(a,t,s,o)};TOOL.times=function(e,t,s){return TOOL.generate_menu("times",e,t,s)};TOOL.keywords=function(e,t,s){return TOOL.generate_menu("keywords",e,t,s)};TOOL.generate_menu=function(e,t,s,o){var a=0,n={};$("#items .scheduleinfo ."+e+" .text").each(function(){var e=$(this).text();if(n[e]){n[e]++}else{n[e]=1}a++});if(0==a){return""}var r=[];for(var d in n){r.push([d,n[d]])}r.sort(function(e,t){return e[1]<t[1]?1:e[1]>t[1]?-1:e[0]<t[0]?-1:e[0]>t[0]?1:0});for(var a=0,d;a<r.length;a++){d=r[a][0]+" ("+r[a][1]+")";r[a]=HTML.tag("option",d,{value:d})}r=$(HTML.tag("select",r.join("")));return TOOL.dialog_menu(r,t,s,o)};TOOL.dialog_menu=function(e,t,s,o){e.prop("name",t);e.prop("id","id_"+t);if(s){s=s.replace(/ style="[^"]*"/g,"");s=s.replace(/[\r\n]+/g,"");s=TOOL.trim(s);var n=!1;e.find("option").each(function(){var e=$(this).val();window.console.log("v="+e+", value="+s);if(!1==n&&e&&(0==e.indexOf(s)||0==s.indexOf(e))){n=!0;this.selected=!0;this.setAttribute("selected","selected")}else{this.selected=!1;this.removeAttribute("selected")}})}if(o){if(o.size){var r=e.find("option:not(:empty)").length;r=Math.min(r,o.size);if(1>=r){delete o.size;delete o.multiple}else{o.size=r;o.multiple="multiple";e.find("option:empty").remove()}}for(var d in o){e.prop(d,o[d])}}var a=0;e.find("option").each(function(){var e=$(this).text();$(this).prop("title",e);$(this).text(UNICODE.shorten(e));if(e){a++}});if(0==a){return""}return e.prop("outerHTML")};TOOL.boldcenter=function(e,t){return HTML.tag("td",HTML.tag("b",t),{align:"center"})};TOOL.multilang=function(e,t){return HTML.tag("span",e,{class:"multilang",lang:t})};TOOL.multilangs=function(e,t){var s=TOOL.form_multilang_values(e,t),o="",a=[];for(var n in s){o=s[n];a.push(TOOL.multilang(o,n))}if(2>a.length){return o}return a.join("")};TOOL.force_simple_html=function(e){return e.replace(/<(\/?\w+)\b[^>]*>/g,"<$1>").replace(/<\/([^>]*)>/g,"<$1/>").replace(/<(?!br|hr|b|i|u|em|strong|big|small|sup|sub|tt|var)[^>]*>/g,"").replace(/<([^>]*)\/>/g,"</$1>")};TOOL.force_single_line=function(e){return TOOL.trim(e.replace(/<br\b[^>]*>/g," "))};TOOL.pad=function(e,t,s,o){if(TOOL.empty(e)){return""}else{e+=""}if(TOOL.empty(t)){t=2}if(TOOL.empty(s)){s=isNaN(e)?" ":"0"}if(TOOL.empty(o)){o=isNaN(e)?!1:!0}while(e.length<t){if(o){e=s+e}else{e=e+s}}return e};TOOL.trim=function(e){if(TOOL.empty(e)){return""}else{e+=""}return e.replace(/(^\s+)|(\s+$)/g,"").replace(/\s+/g," ")};TOOL.form_startfinish=function(e,t,s,o){return TOOL.pad(e)+TOOL.str.labelsep+TOOL.pad(t)+TOOL.str.durationseparator+TOOL.pad(s)+TOOL.str.labelsep+TOOL.pad(o)};TOOL.form_duration=function(e,t,s,o){var a=0;if(s<e){a=23}if(s==e&&o<=t){a=23}a=60*(a+s-e);a=TOOL.pad(a+o-t);return a};TOOL.form_value=function(e,t,s){var o=$(e).find("[name="+t+"]");if(o.length){switch(!0){case o.is("select"):o=o.find("option:selected");break;case o.is("input[type=radio]"):o=o.find("input:checked");break;case o.is("input[type=checkbox]"):o=o.is(":checked")?o:"";break;}}if(0==o.length){return s?0:""}if(1==o.length){o=o.val();return s?parseInt(o):o}for(var a=[],n=0;n<o.length;n++){a.push(s?parseInt(o[n].value):o[n].value)}return a};TOOL.form_values=function(e,t,s){var o=[];$(e).find("[name^="+t+"]").each(function(){var a=$(this).prop("name");if(a==t){o=TOOL.form_value(e,t,s)}else{var n=parseInt(a.substr(t.length));o[n]=TOOL.form_value(e,a,s)}});return o};TOOL.form_multilang_values=function(e,t){var s={},o,a;$(e).find("input[name^="+t+"]").each(function(){o=$(this).prop("name").substr(t.length+1);a=a=TOOL.trim($(this).val());if(a){s[o]=TOOL.force_simple_html(a)}});return s};TOOL.empty=function(e){return e===void 0||null===e};TOOL.fix_multislot_times=function(e){var t=null;e.querySelectorAll(".session[rowspan]").forEach(function(e){if(1==e.rowSpan){e.removeAttribute("rowspan");return}var s=[],o=e.parentNode,a=o,n=1;while(a&&n<e.rowSpan){a=a.nextElementSibling;n++}if(o){o=o.querySelector(".timeheading .startfinish");if(o){o=o.innerText}}else{o=""}if(a){a=a.querySelector(".timeheading .startfinish");if(a){a=a.innerText}}else{a=""}t=/^ *([0-9]+) *: *([0-9]+) */.exec(o);if(t){s.push(t[1]+":"+t[2]);o=parseInt(60*t[1])+parseInt(t[2])}t=/ *([0-9]+) *: *([0-9]+) *$/.exec(a);if(t){s.push(t[1]+":"+t[2]);a=parseInt(60*t[1])+parseInt(t[2])}if(o&&a){if(a<o){a+=parseInt(1440)}var r=e.querySelector(".duration");if(r){r.innerText=a-o+" mins"}var r=e.querySelector(".startfinish");if(r){r.innerText=s.join(" - ")}}})};return TOOL});
//# sourceMappingURL=tool_setupschedule.min.js.map
