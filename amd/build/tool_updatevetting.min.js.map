{"version":3,"sources":["../src/tool_updatevetting.js"],"names":["define","$","JUI","STR","TOOL","dialogid","str","init","opts","i","get_strings","done","s","cancel","close","ok","blockroot","location","href","replace","toolroot","pageid","iconroot","prop","iconedit","iconremove","rel","type","appendTo","click","checked","not","each","evt","title","closest","siblings","text","ajax","html","substr","indexOf","open_dialog","stopPropagation","actiontext","actionicon","actionfunction","showcancelbutton","dialogbox","document","getElementById","empty","createElement","setAttribute","append","dialog","buttons","push","canceltext","cancelfunction","close_dialog","v"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the term of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * javascript for the the updatevetting tool\n *\n * @module      block_maj_submissions/tool_updatevetting\n * @category    output\n * @copyright   Gordon Bateson\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since       2.9\n */\ndefine([\"jquery\", \"jqueryui\", \"core/str\"], function($, JUI, STR) {\n\n    /** @alias module:block_maj_submissions/tool_updatevetting */\n    var TOOL = {};\n\n    // the DOM id of the dialog box\n    TOOL.dialogid = \"dialog\";\n\n    // initialize string cache\n    TOOL.str = {};\n\n    TOOL.init = function(opts) {\n\n        // cache the opts, if any, passed from the server\n        if (opts) {\n            for (var i in opts) {\n                TOOL[i] = opts[i];\n            }\n        }\n\n        // set up strings\n        STR.get_strings([\n            {\"key\": \"cancel\", \"component\": \"moodle\"},\n            {\"key\": \"close\",  \"component\": \"moodle\"},\n            {\"key\": \"ok\",     \"component\": \"moodle\"}\n        ]).done(function(s) {\n            var i = 0;\n            TOOL.str.cancel = s[i++];\n            TOOL.str.close  = s[i++];\n            TOOL.str.ok     = s[i++];\n        });\n\n        // extract URL and block instance id from page URL\n        TOOL.blockroot = location.href.replace(new RegExp(\"^(.*?)/tools.*$\"), \"$1\");\n        TOOL.toolroot = location.href.replace(new RegExp(\"^(.*?)/tool.php.*$\"), \"$1\");\n        TOOL.pageid = location.href.replace(new RegExp(\"^.*?\\\\bid=([0-9]+)\\\\b.*$\"), \"$1\");\n        TOOL.iconroot = $(\"img.iconhelp\").prop(\"src\").replace(new RegExp(\"/[^/]+$\"), \"\");\n\n        TOOL.iconedit = TOOL.iconroot + \"/i/edit\";\n        TOOL.iconremove = TOOL.iconroot + \"/i/delete\";\n\n        // fetch CSS\n        $(\"<link/>\", {\n            rel: \"stylesheet\", type: \"text/css\",\n            href: TOOL.toolroot + \"/styles.css\"\n        }).appendTo(\"head\");\n\n        // setup select all/none\n        $(\"input[type=checkbox][name='submissions[0]']\").click(function(){\n            var checked = $(this).prop(\"checked\");\n            $(\"input[type=checkbox][name^=submissions]\").not(\"[name='submissions[0]']\").each(function(){\n                $(this).prop('checked', checked);\n            });\n        });\n\n        $(\".submissionid a\").click(function(evt){\n            var title = $(this).closest(\".submissionid\").siblings(\".presentationtitle\").text();\n            $.ajax({\n                \"url\": $(this).prop(\"href\"),\n                \"dataType\": \"text\",\n                \"method\": \"GET\",\n                \"success\": function(html) {\n                    html = html.substr(html.indexOf('<ul class=\"nav nav-tabs\">'));\n                    html = html.substr(html.indexOf('</ul>'));\n                    html = html.substr(0, html.indexOf('</form>'));\n                    html = html.replace(new RegExp('<div class=\"paging\">.*?</div>', \"g\"), '');\n                    TOOL.open_dialog(evt, title, html);\n                }\n            });\n            evt.stopPropagation();\n            return false;\n        });\n    };\n\n    TOOL.open_dialog = function(evt, title, html, actiontext, actionicon, actionfunction, showcancelbutton) {\n        var showactionbutton = true;\n\n        // locate dialog box in DOM\n        // (create it, if necessary)\n        var dialogbox = document.getElementById(TOOL.dialogid);\n        if (TOOL.empty(dialogbox)) {\n            dialogbox = document.createElement(\"DIV\");\n            dialogbox.setAttribute(\"id\", TOOL.dialogid);\n            $(\"body\").append(dialogbox);\n        }\n\n        // cache jQuery object for dialog\n        var dialog = $(dialogbox);\n\n        // create/close the dialog element\n        if (TOOL.empty(dialog.dialog(\"instance\"))) {\n            dialog.dialog({\"autoOpen\": false, \"width\": \"auto\"});\n        } else {\n            if (dialog.dialog(\"isOpen\")) {\n                dialog.dialog(\"close\");\n            }\n        }\n\n        // update the dialog title\n        dialog.dialog(\"option\", \"title\", title);\n\n        // update the dialog HTML\n        dialog.html(html);\n\n        // set the dialog mode\n        dialog.dialog(\"option\", \"modal\", showcancelbutton);\n\n        // update the dialog buttons\n        var buttons = [];\n        if (showactionbutton) {\n            if (TOOL.empty(actiontext)) {\n                actiontext = TOOL.str.ok;\n            }\n            if (TOOL.empty(actionicon)) {\n                actionicon = \"ui-icon-check\";\n            }\n            if (TOOL.empty(actionfunction)) {\n                actionfunction = function(){\n                    $(this).dialog(\"close\");\n                };\n            }\n            buttons.push({\"text\": actiontext,\"click\": actionfunction}); // \"icon\": actionicon\n        }\n        if (showcancelbutton) {\n            var canceltext = TOOL.str.cancel;\n            //var cancelicon = \"ui-icon-cancel\";\n            var cancelfunction = function(){\n                $(this).dialog(\"close\");\n            };\n            buttons.push({\"text\": canceltext, \"click\": cancelfunction}); // \"icon\": cancelicon\n        }\n        dialog.dialog(\"option\", \"buttons\", buttons);\n\n        // open the dialog box\n        dialog.dialog(\"open\");\n\n        // prevent the current click causing\n        // the parent element to be selected\n        evt.stopPropagation();\n    };\n\n    TOOL.close_dialog = function() {\n        $(\"#\" + TOOL.dialogid).dialog(\"close\");\n    };\n\n    TOOL.empty = function(v) {\n        return (v===undefined || v===null);\n    };\n\n    return TOOL;\n});\n"],"file":"tool_updatevetting.min.js"}